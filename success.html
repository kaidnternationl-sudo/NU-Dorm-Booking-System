<script>
    // ุงูุจูุงูุงุช ุงูุฏููุงููููุฉ
    document.addEventListener('DOMContentLoaded', function() {
        // ุงูุชุญูู ูู ุงูุญุฌุฒ
        const selectedRoom = JSON.parse(localStorage.getItem('selectedRoom')) || null;
        const userData = JSON.parse(localStorage.getItem('userData')) || {};
        const userType = localStorage.getItem('userType') || 'male';
        const buildingId = localStorage.getItem('selectedBuilding');
        
        if (!selectedRoom) {
            alert('ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุญุฌุฒ. ูุฑุฌู ุงูุจุฏุก ูู ุฌุฏูุฏ.');
            window.location.href = 'building_selection.html';
            return;
        }
        
        // ุชุทุจูู ุงููุณุฎุฉ ุงูููุงุณุจุฉ ุญุณุจ ุงูููุน
        if (userType === 'female') {
            applyFemaleTheme();
        }
        
        // ุนุฑุถ ูุญุงูุงุฉ ุฅุฑุณุงู ุงูุจูุงูุงุช
        simulateAPISend();
        
        // ุชูููุฏ ุฑูู ูุฑุฌุนู ูุฑูุฏ
        const referenceNumber = generateReferenceNumber(userData.id);
        document.getElementById('referenceNumber').textContent = referenceNumber;
        
        // ุญูุธ ุงูุฑูู ุงููุฑุฌุนู
        localStorage.setItem('lastReference', referenceNumber);
        
        // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุทุงูุจ
        document.getElementById('studentName').textContent = userData.name || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('studentId').textContent = userData.id || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('studentGPA').textContent = userData.gpa || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('studentCity').textContent = userData.city || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('priorityScore').textContent = (userData.priority || 75) + '%';
        
        // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูุญุฌุฒ
        document.getElementById('buildingNumber').textContent = buildingId || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('roomNumber').textContent = selectedRoom.id || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('roomType').textContent = selectedRoom.type || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('roomFloor').textContent = selectedRoom.floor || 'ุบูุฑ ูุญุฏุฏ';
        document.getElementById('roomPrice').textContent = (selectedRoom.price || 5000).toLocaleString() + ' ุฑูุงู';
        
        // ุญุณุงุจ ุงููุจูุบ ุงูุฅุฌูุงูู
        const roomPrice = selectedRoom.price || 5000;
        const serviceFee = 500;
        const tax = roomPrice * 0.15;
        const totalAmount = roomPrice + serviceFee + tax;
        
        document.getElementById('totalAmount').textContent = totalAmount.toLocaleString() + ' ุฑูุงู';
        
        // ุชุงุฑูุฎ ุงูุญุฌุฒ
        const now = new Date();
        document.getElementById('reservationDate').textContent = now.toLocaleDateString('ar-SA') + ' ' + now.toLocaleTimeString('ar-SA');
        
        // ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุฎุฒูุฉ ุงูุณุฑูุฉ
        sendToVault(userData, selectedRoom, buildingId, referenceNumber, totalAmount);
    });
    
    function applyFemaleTheme() {
        // ุชุบููุฑ ุงูุณูุฉ ููุทุงูุจุงุช
        document.getElementById('successHeader').classList.add('female-theme');
        document.getElementById('reservationNumber').classList.add('female-theme');
        document.getElementById('studentCard').classList.add('female-theme');
        document.getElementById('reservationCard').classList.add('female-theme');
        document.getElementById('priorityCard').classList.add('female-theme');
        
        // ุชุบููุฑ ุงูุฃููููุงุช
        const icon = document.querySelector('.success-icon i');
        icon.className = 'fas fa-star';
        
        // ุชุบููุฑ ุงููุตูุต
        document.querySelector('.success-subtitle').textContent = 'ุชู ุฅุฑุณุงู ุทูุจูู ุฅูู ุฎุงุฏู ุฌุงูุนุฉ ูุฌุฑุงู ุจูุฌุงุญ';
    }
    
    function generateReferenceNumber(nationalId) {
        const date = new Date();
        const timestamp = date.getTime().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        return `NU-${nationalId.slice(-4)}-${timestamp}-${random}`;
    }
    
    function simulateAPISend() {
        // ุนุฑุถ ุฑุณุงูุฉ ุงูุชุญููู
        const loadingSpinner = document.getElementById('loadingSpinner');
        const apiMessage = document.getElementById('apiMessage');
        
        loadingSpinner.style.display = 'block';
        
        // ูุญุงูุงุฉ ุฅุฑุณุงู API
        setTimeout(() => {
            loadingSpinner.style.display = 'none';
            apiMessage.style.display = 'block';
            
            // ูุญุงูุงุฉ ุงุณุชุฌุงุจุฉ ุงูุฎุงุฏู
            console.log('โ ุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุฎุงุฏู ุฌุงูุนุฉ ูุฌุฑุงู');
            
            // ุฅุธูุงุฑ ุฑุณุงูุฉ ุดูุฑ ุฑุณููุฉ
            showThankYouMessage();
        }, 3000);
    }
    
    function showThankYouMessage() {
        // ุฅุธูุงุฑ ุฑุณุงูุฉ ุดูุฑ ุฑุณููุฉ ููุทุงูุจ
        const thankYouMessage = document.createElement('div');
        thankYouMessage.className = 'thank-you-message';
        thankYouMessage.innerHTML = `
            <div style="
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.5s ease;
            ">
                <div style="
                    background: linear-gradient(135deg, #1a5d1a, #2e8b57);
                    padding: 40px;
                    border-radius: 20px;
                    text-align: center;
                    max-width: 500px;
                    width: 90%;
                    color: white;
                    animation: slideUp 0.5s ease;
                ">
                    <div style="font-size: 4rem; margin-bottom: 20px;">๐</div>
                    <h2 style="margin-bottom: 15px; font-size: 1.8rem;">ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ</h2>
                    <p style="margin-bottom: 20px; font-size: 1.2rem;">
                        ุดูุฑุงู ูู ุนูู ุงุณุชุฎุฏุงู ูุธุงู ุณูู ุฌุงูุนุฉ ูุฌุฑุงู
                    </p>
                    <p style="margin-bottom: 30px; opacity: 0.9;">
                        ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ ุฅูู ุนูุงุฏุฉ ุดุคูู ุงูุทูุงุจ<br>
                        ูุชู ุญูุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุดูุฑุฉ
                    </p>
                    <button onclick="closeThankYouMessage()" style="
                        background: white;
                        color: #1a5d1a;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 10px;
                        font-size: 1.1rem;
                        font-weight: bold;
                        cursor: pointer;
                    ">
                        ููุงูู
                    </button>
                </div>
            </div>
        `;
        
        // ุฅุถุงูุฉ ุงูุฃููุงุท
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translateY(50px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(thankYouMessage);
    }
    
    function closeThankYouMessage() {
        const message = document.querySelector('.thank-you-message');
        if (message) {
            message.remove();
        }
    }
    
    function sendToVault(userData, roomData, buildingId, referenceNumber, totalAmount) {
        // ุชูููุฏ ุจูุงูุงุช ุงูุทุงูุจ ุงููุงููุฉ ููุฎุฒูุฉ
        const studentRecord = {
            // ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ ูุงูุงุชุตุงู
            fullName: userData.name,
            nationalId: userData.id,
            universityId: generateUniversityId(userData.id),
            phone: generateSaudiPhone(),
            email: generateUniversityEmail(userData.name, userData.id),
            guardianPhone: generateSaudiPhone(),
            
            // ุงูุจูุงูุงุช ุงูุฃูุงุฏูููุฉ
            major: userData.college || 'ุบูุฑ ูุญุฏุฏ',
            studyType: 'ุงูุชุธุงู',
            admissionDate: generateAdmissionDate(),
            gpa: userData.gpa,
            
            // ุชูุงุตูู ุงูุณูู
            building: buildingId,
            room: roomData.id,
            roomType: roomData.type,
            roomPrice: roomData.price,
            totalFees: totalAmount,
            
            // ุจูุงูุงุช ุงููุธุงู
            referenceNumber: referenceNumber,
            applicationDate: new Date().toISOString(),
            documentStatus: 'ูุฑูู',
            paymentStatus: 'ุจุงูุชุธุงุฑ ุงูุฏูุน',
            status: 'ูุคูุฏ',
            priority: userData.priority || 75,
            city: userData.city,
            gender: userData.gender === 'male' ? 'ุฐูุฑ' : 'ุฃูุซู',
            registrationDate: new Date().toLocaleDateString('ar-SA')
        };
        
        // ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุฎุฒูุฉ
        if (window.addToVault) {
            window.addToVault(studentRecord);
            console.log('๐ฆ ุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุฎุฒูุฉ ุงูุณุฑูุฉ:', studentRecord);
        } else {
            // ุญูุธ ูุคูุช ูู localStorage ุฅุฐุง ูู ุชูู ุงูุฎุฒูุฉ ูุชุงุญุฉ
            const vaultBackup = JSON.parse(localStorage.getItem('vaultBackup') || '[]');
            vaultBackup.push(studentRecord);
            
            // ุงูุงุญุชูุงุธ ุจุขุฎุฑ 20 ููุท
            if (vaultBackup.length > 20) {
                vaultBackup.shift();
            }
            
            localStorage.setItem('vaultBackup', JSON.stringify(vaultBackup));
            console.log('๐ฆ ุชู ุญูุธ ุงูุจูุงูุงุช ูู ุงููุณุฎ ุงูุงุญุชูุงุทู:', studentRecord);
        }
        
        // ุฅุถุงูุฉ ุฅูู ุณุฌู ุฌููุน ุงูุญุฌูุฒุงุช
        addToAllReservations(userData, roomData, buildingId, referenceNumber, studentRecord);
    }
    
    function generateUniversityId(nationalId) {
        // ุชูููุฏ ุฑูู ุฌุงูุนู ุนุดูุงุฆู
        const year = new Date().getFullYear().toString().slice(-2);
        const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
        return `NU${year}${random}`;
    }
    
    function generateSaudiPhone() {
        // ุชูููุฏ ุฑูู ูุงุชู ุณุนูุฏู
        const prefixes = ['050', '055', '056', '057', '058', '059'];
        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const number = Math.floor(Math.random() * 10000000).toString().padStart(7, '0');
        return `${prefix}${number}`;
    }
    
    function generateUniversityEmail(name, id) {
        // ุชูููุฏ ุจุฑูุฏ ุฌุงูุนู
        const nameParts = name.split(' ');
        const firstName = nameParts[0] || 'student';
        const lastName = nameParts[nameParts.length - 1] || 'nu';
        return `${firstName}.${lastName}.${id.slice(-4)}@nu.edu.sa`.toLowerCase();
    }
    
    function generateAdmissionDate() {
        // ุชูููุฏ ุชุงุฑูุฎ ุงูุชุญุงู ุนุดูุงุฆู (ุขุฎุฑ 4 ุณููุงุช)
        const currentYear = new Date().getFullYear();
        const year = currentYear - Math.floor(Math.random() * 4);
        const month = Math.floor(Math.random() * 12) + 1;
        const day = Math.floor(Math.random() * 28) + 1;
        return `${year}/${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;
    }
    
    function addToAllReservations(userData, roomData, buildingId, reference, studentRecord) {
        const allReservations = JSON.parse(localStorage.getItem('all_reservations')) || [];
        
        const reservation = {
            id: reference,
            studentId: userData.id,
            studentName: userData.name,
            studentGPA: userData.gpa,
            studentCity: userData.city,
            studentGender: userData.gender,
            phone: studentRecord.phone,
            email: studentRecord.email,
            guardianPhone: studentRecord.guardianPhone,
            major: studentRecord.major,
            studyType: studentRecord.studyType,
            admissionDate: studentRecord.admissionDate,
            roomId: roomData.id,
            roomType: roomData.type,
            roomPrice: roomData.price,
            buildingId: buildingId,
            reservationDate: new Date().toISOString(),
            status: 'ูุคูุฏ',
            priority: userData.priority || 75,
            documentStatus: 'ูุฑูู'
        };
        
        allReservations.push(reservation);
        
        // ุงูุงุญุชูุงุธ ุจุขุฎุฑ 20 ููุท
        if (allReservations.length > 20) {
            allReservations.shift();
        }
        
        localStorage.setItem('all_reservations', JSON.stringify(allReservations));
    }
    
    function printReservation() {
        window.print();
    }
    
    function goToDashboard() {
        // ููุน ุงูุทุงูุจ ูู ุงููุตูู ุฅูู ููุญุฉ ุงูุชุญูู
        alert('โ๏ธ ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ููุฅุฏุงุฑุฉ ููุท.\nุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ ุฅูู ุนูุงุฏุฉ ุดุคูู ุงูุทูุงุจ.');
    }
    
    function goToHome() {
        window.location.href = 'index.html';
    }
          </script>
